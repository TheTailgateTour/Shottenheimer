<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scan for The Shottenheimer Menu â€¢ QR</title>
  <meta name="theme-color" content="#E31837" />
</head>
<body>
  <main class="card">
    <h1>Scan the QR Code</h1>
    <p class="sub">Opens <strong><a href="index.html" class="inline">The Shottenheimer</a></strong> menu</p>
    <p class="url" id="menuUrl"></p>
    <div id="qrcode" class="qr" aria-label="QR code"></div>
    <div class="row">
      <button id="printBtn">Print</button>
      <button id="downloadBtn">Download PNG</button>
    </div>
  </main>

  <!-- Try CDN first (okay to leave; if blocked, we fallback automatically) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
          integrity="sha512-Mw8CKQ2JrX8o1bXj3k5Qh0V2Gq04cyrbq8WmAyd1H92rQ8Yw0ylkWw+N7pUdU4XMxr2W5fQ20oy3a0C4nU8Y7Q=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    (function () {
      // Optional: hardcode your URL here so it never depends on the page location.
      // If left blank, we derive it from the current URL.
      const HARDCODED_URL = 'https://thetailgatetour.github.io/shottenheimer/';

      function targetUrl() {
        if (HARDCODED_URL) return HARDCODED_URL;
        const href = window.location.href;
        let base = href.replace(/qr(-fixed)?\\.html.*/i, '');
        if (!base.endsWith('/')) base += '/';
        return base;
      }

      const url = targetUrl();
      const host = document.getElementById('qrcode');
      const urlText = document.getElementById('menuUrl');
      urlText.textContent = url;

      function clearQR(){ host.innerHTML = ''; }

      function generateWithLib() {
        try {
          if (typeof QRCode === 'function') {
            clearQR();
            new QRCode(host, { text: url, width: 288, height: 288, colorDark: '#000', colorLight: '#fff' });
            return true;
          }
        } catch (e) { console.warn('QRCode lib error', e); }
        return false;
      }

      function generateFallbackImg() {
        // Fallback: use an image QR (no JS library required)
        clearQR();
        const img = document.createElement('img');
        img.alt = 'QR code';
        img.width = 288; img.height = 288;
        img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=288x288&data=' + encodeURIComponent(url);
        host.appendChild(img);
      }

      // Try library; if blocked/not loaded, use fallback image
      if (!generateWithLib()) {
        generateFallbackImg();
      }

      // Buttons
      document.getElementById('printBtn').addEventListener('click', () => window.print());

      document.getElementById('downloadBtn').addEventListener('click', () => {
        const canvas = host.querySelector('canvas');
        if (canvas) {
          const a = document.createElement('a');
          a.download = 'shottenheimer-qr.png';
          a.href = canvas.toDataURL('image/png');
          a.click();
          return;
        }
        const img = host.querySelector('img');
        if (img) {
          // Open fallback image in a new tab so it can be saved
          window.open(img.src, '_blank');
          return;
        }
        alert('QR not ready.');
      });
    })();
  </script>
</body>
</html>
